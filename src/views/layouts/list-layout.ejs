<% layout('../layouts/main') -%>
<% block('title', blocks.title ) -%>
<h1>
  <%= blocks.h1 %>
</h1>
<% if (blocks.messages.length) { %>
  <ul>
    <% blocks.messages.forEach(m=> { %><li>
        <%= m %>
      </li>
      <% }) %>
  </ul>
<% } %>
<% if (blocks.data?.html?.[0]?.length) { %>
  <% 
    const capitalize=(value)=> {
      const str = String(value);
      return str.split("_").map((word, i) => word.charAt(0).toUpperCase() + word.slice(1)).join("");
    }
  %>
  <form method="GET" action="<%=blocks.searchAction%>" style="margin-bottom:1em;">
    <% Object.keys(blocks.data.html[0][0]).forEach(key=> { %>
      <input type="text" name="search<%=capitalize(key)%>" placeholder="Поиск по <%=key%>"
        value="<%= query['search' + capitalize(key)] || '' %>" />
    <%}) %>
    <button type="submit">Применить</button>
    <a href="<%=blocks.hrefReset%>">Сброс</a>
  </form>
<% } %>
<a href="<%=blocks.hrefAdd%>">
  <%=blocks.linkAddText%>
</a>

<% if (blocks.data?.html?.[0]?.length) { %>
  <%
    const qs = (field) => {
      const q = {...query, sortField: field,
        sortOrder: query.sortField === field && query.sortOrder==='asc'
        ? 'desc' : 'asc'
      };
      return Object.entries(q)
        .map(([k,v])=> `${k}=${encodeURIComponent(v)}`)
        .join('&');
    };
  %>
  <div>
    <div>
      <% Object.keys(blocks.data.html[0][0]).forEach(key=> { %>
        <div>
          <a href="<%=blocks.searchAction%>?<%=key%>">
            <%=key%>
          </a>
        </div>
      <%}) %>
    </div>
  </div>
<%} else {%>
<div>Нет данных</div>
<%}%>
<%-body -%>